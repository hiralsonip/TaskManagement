<div class="min-h-screen bg-gray-100 flex flex-col">
    <!-- Header -->
    <header class="bg-white shadow p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold text-gray-800">Task Management Dashboard</h1>

        @if(!user) {
        <div>
            <button (click)="loginClickHandler()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                Login
            </button>
        </div>
        } @else {
        <div>
            <button (click)="logoutClickHandler()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                Logout
            </button>
        </div>
        }

    </header>

    <!-- Main content -->
    <main class="flex-1 p-6">
        <div class="text-center my-10">
            <!-- Header -->
            <div *ngIf="user">
                <h2 class="text-2xl font-semibold text-gray-700 mb-2">Hello {{user?.username}}</h2>
                <p class="text-gray-500">Welcome to your dashboard page</p>
            </div>

            <!-- Task count and organization -->
            <div class="mt-4 text-gray-700 font-medium">
                Tasks: {{ filteredTasks.length }} | Organization: {{ user?.organization?.name }}
            </div>
        </div>

        <!-- Create tasks -->
        @if(roles.includes('Admin') || roles.includes('Owner')) {
        <div class="bg-white p-4 rounded shadow mb-6 flex flex-row gap-2 sm:w-full lg:w-[32%]">
            <input type="text" [(ngModel)]="newTaskTitle" placeholder="New task title"
                class="border rounded px-2 py-1 w-full" />
            <button (click)="createTask()" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 self-end">
                Create
            </button>
        </div>
        }

        <div class="flex flex-wrap items-center gap-4 mb-6">
            <!-- Filter by status -->
            <label for="filter" class="text-gray-500 text-sm">Filter</label>
            <select [(ngModel)]="filterStatus" class="border rounded px-2 py-1">
                <option value="">All statuses</option>
                <option value="todo">To Do</option>
                <option value="inprogress">In Progress</option>
                <option value="done">Done</option>
            </select>

            <!-- Sort by -->
            <label for="sort" class="text-gray-500 text-sm">Sort By</label>
            <select [(ngModel)]="sortBy" class="border rounded px-2 py-1">
                <option value="" disabled selected>-- Select --</option>
                <option value="title">Title</option>
                <option value="status">Status</option>
                <option value="owner">Owner</option>
            </select>

            <!-- Sort direction -->
            <label for="order" class="text-gray-500 text-sm">Order</label>
            <select [(ngModel)]="sortDirection" class="border rounded px-2 py-1">
                <option value="asc">Ascending</option>
                <option value="desc">Descending</option>
            </select>
        </div>

        <!-- Tasks section -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            @for (task of filteredTasks; track task.id) {
            <div class="bg-white p-4 rounded shadow hover:shadow-md transition flex items-center justify-between">
                <div>
                    <div class="mb-2">
                        @if(roles.includes('Admin') || roles.includes('Owner')) {
                        <input [(ngModel)]="task.title" class="border rounded px-2 py-1 w-full"
                            placeholder="Task title" />
                        } @else {
                        <h3 class="font-bold text-gray-700">{{ task.title }}</h3>
                        }
                    </div>

                    @if(roles.includes('Admin') || roles.includes('Owner')) {
                    <select [(ngModel)]="task.status" class="border rounded px-2 py-1 w-full">
                        <option value="todo">To Do</option>
                        <option value="inprogress">In Progress</option>
                        <option value="done">Done</option>
                    </select>
                    } @else {
                    <p class="text-gray-500">Status: {{task.status && statusMap[task.status] || task.status }}</p>
                    }

                    <div class="my-1">
                        <p class="text-gray-500 text-sm">Assigned to : {{task?.owner && task?.owner?.username ||
                            "Unassigned" }}
                        </p>
                    </div>
                </div>

                <!-- Update button -->
                <div class="flex gap-2">
                    @if(roles.includes('Admin') || roles.includes('Owner')) {
                    <button (click)="updateTask(task)"
                        class="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600">
                        Update
                    </button>
                    }

                    @if(roles.includes('Owner')) {
                    <button (click)="deleteTask(task)"
                        class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600">
                        Delete
                    </button>
                    }
                </div>
            </div>
            }
        </div>

        <!-- Toast message -->
        @if(toastMessage && toastType === 'success') {
        <div
            class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow transition-opacity duration-500">
            {{ toastMessage }}
        </div>
        }
        @if(toastMessage && toastType === 'error') {
        <div
            class="fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded shadow transition-opacity duration-500">
            {{ toastMessage }}
        </div>
        }
        @if(toastMessage && toastType === 'warning') {
        <div
            class="fixed bottom-4 right-4 bg-yellow-400 text-white px-4 py-2 rounded shadow transition-opacity duration-500">
            {{ toastMessage }}
        </div>
        }

    </main>
</div>